import{_ as b,f as E,l as p,m as g,r as w,k as h,o as S,c as _,E as O,M as $}from"./entry.IM7UvsXg.js";import{c as j}from"./index.KAWpTnHL.js";import{u as A}from"./uid.KLLbMoZc.js";import"./index.FpbCe-zC.js";class m extends Error{constructor(n){super(n),this.message=n,Object.setPrototypeOf(this,m.prototype)}}const J=E({props:{schema:{type:Object,default:void 0},state:{type:Object,required:!0},validate:{type:Function,default:()=>[]},validateOn:{type:Array,default:()=>["blur","input","change","submit"]}},emits:["submit","error"],setup(e,{expose:n,emit:r}){const s=j(`form-${A()}`);p(()=>{s.on(async t=>{var i;t.type!=="submit"&&((i=e.validateOn)!=null&&i.includes(t.type))&&await d(t.path,{silent:!0})})}),g(()=>{s.reset()});const a=w([]);h("form-errors",a),h("form-events",s);const l=w({});h("form-inputs",l);async function f(){let t=await e.validate(e.state);if(e.schema)if(B(e.schema))t=t.concat(await M(e.state,e.schema));else if(k(e.schema))t=t.concat(await Y(e.state,e.schema));else if(P(e.schema))t=t.concat(await V(e.state,e.schema));else if(Z(e.schema))t=t.concat(await q(e.state,e.schema));else throw new Error("Form validation failed: Unsupported form schema");return t}async function d(t,i={silent:!1}){let o=t;if(t&&!Array.isArray(t)&&(o=[t]),o){const u=a.value.filter(c=>!o.includes(c.path)),v=(await f()).filter(c=>o.includes(c.path));a.value=u.concat(v)}else a.value=await f();if(!i.silent&&a.value.length>0)throw new m(`Form validation failed: ${JSON.stringify(a.value,null,2)}`);return e.state}async function y(t){var o;const i=t;try{(o=e.validateOn)!=null&&o.includes("submit")&&await d();const u={...i,data:e.state};r("submit",u)}catch(u){if(!(u instanceof m))throw u;const v={...i,errors:a.value.map(c=>({...c,id:l.value[c.path]}))};r("error",v)}}return n({validate:d,errors:a,setErrors(t,i){a.value=t,i?a.value=a.value.filter(o=>o.path!==i).concat(t):a.value=t},async submit(){await y(new Event("submit"))},getErrors(t){return t?a.value.filter(i=>i.path===t):a.value},clear(t){t?a.value=a.value.filter(i=>i.path!==t):a.value=[]}}),{onSubmit:y}}});function k(e){return e.validate&&e.__isYupSchema__}function F(e){return e.inner!==void 0}async function Y(e,n){try{return await n.validate(e,{abortEarly:!1}),[]}catch(r){if(F(r))return r.inner.map(s=>({path:s.path??"",message:s.message}));throw r}}function B(e){return e.parse!==void 0}async function M(e,n){const r=await n.safeParseAsync(e);return r.success===!1?r.error.issues.map(s=>({path:s.path.join("."),message:s.message})):[]}function P(e){return e.validateAsync!==void 0&&e.id!==void 0}function U(e){return e.isJoi===!0}async function V(e,n){try{return await n.validateAsync(e,{abortEarly:!1}),[]}catch(r){if(U(r))return r.details.map(s=>({path:s.path.join("."),message:s.message}));throw r}}function Z(e){return e._parse!==void 0}async function q(e,n){const r=await n._parse(e);return r.issues?r.issues.map(s=>{var a;return{path:((a=s.path)==null?void 0:a.map(l=>l.key).join("."))||"",message:s.message}}):[]}function x(e,n,r,s,a,l){return S(),_("form",{onSubmit:n[0]||(n[0]=$((...f)=>e.onSubmit&&e.onSubmit(...f),["prevent"]))},[O(e.$slots,"default")],32)}const G=b(J,[["render",x]]);export{G as default};
