import{_ as w,g as p,r as v,k as h,o as E,c as b,E as g,L as S}from"./entry.A1eWV8bd.js";import{u as _}from"./index.9G_8O0xX.js";import{u as O}from"./uid.RBzw2_Kg.js";import"./index.gkvkA94u.js";class f extends Error{constructor(s){super(s),this.message=s,Object.setPrototypeOf(this,f.prototype)}}const $=p({props:{schema:{type:Object,default:void 0},state:{type:Object,required:!0},validate:{type:Function,default:()=>[]},validateOn:{type:Array,default:()=>["blur","input","change","submit"]}},emits:["submit","error"],setup(e,{expose:s,emit:r}){const i=_(`form-${O()}`);i.on(async t=>{var n;t.type!=="submit"&&((n=e.validateOn)!=null&&n.includes(t.type))&&await m(t.path,{silent:!0})});const a=v([]);h("form-errors",a),h("form-events",i);const c=v({});h("form-inputs",c);async function l(){let t=await e.validate(e.state);if(e.schema)if(A(e.schema))t=t.concat(await F(e.state,e.schema));else if(j(e.schema))t=t.concat(await k(e.state,e.schema));else if(Y(e.schema))t=t.concat(await P(e.state,e.schema));else if(V(e.schema))t=t.concat(await Z(e.state,e.schema));else throw new Error("Form validation failed: Unsupported form schema");return t}async function m(t,n={silent:!1}){if(t){const o=a.value.filter(u=>u.path!==t),d=(await l()).filter(u=>u.path===t);a.value=o.concat(d)}else a.value=await l();if(!n.silent&&a.value.length>0)throw new f(`Form validation failed: ${JSON.stringify(a.value,null,2)}`);return e.state}async function y(t){var n;try{(n=e.validateOn)!=null&&n.includes("submit")&&await m();const o={...t,data:e.state};r("submit",o)}catch(o){if(!(o instanceof f))throw o;const d={...t,errors:a.value.map(u=>({...u,id:c.value[u.path]}))};r("error",d)}}return s({validate:m,errors:a,setErrors(t,n){a.value=t,n?a.value=a.value.filter(o=>o.path!==n).concat(t):a.value=t},getErrors(t){return t?a.value.filter(n=>n.path===t):a.value},clear(t){t?a.value=a.value.filter(n=>n.path===t):a.value=[]}}),{onSubmit:y}}});function j(e){return e.validate&&e.__isYupSchema__}function J(e){return e.inner!==void 0}async function k(e,s){try{return await s.validate(e,{abortEarly:!1}),[]}catch(r){if(J(r))return r.inner.map(i=>({path:i.path??"",message:i.message}));throw r}}function A(e){return e.parse!==void 0}async function F(e,s){const r=await s.safeParseAsync(e);return r.success===!1?r.error.issues.map(i=>({path:i.path.join("."),message:i.message})):[]}function Y(e){return e.validateAsync!==void 0&&e.id!==void 0}function B(e){return e.isJoi===!0}async function P(e,s){try{return await s.validateAsync(e,{abortEarly:!1}),[]}catch(r){if(B(r))return r.details.map(i=>({path:i.path.join("."),message:i.message}));throw r}}function V(e){return e._parse!==void 0}async function Z(e,s){const r=await s._parse(e);return r.issues?r.issues.map(i=>{var a;return{path:((a=i.path)==null?void 0:a.map(c=>c.key).join("."))||"",message:i.message}}):[]}function q(e,s,r,i,a,c){return E(),b("form",{onSubmit:s[0]||(s[0]=S((...l)=>e.onSubmit&&e.onSubmit(...l),["prevent"]))},[g(e.$slots,"default")],32)}const N=w($,[["render",q]]);export{N as default};
